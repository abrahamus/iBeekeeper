{% extends "base.html" %}

{% block title %}Edit Transaction - iBeekeeper{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('transactions.list_transactions') }}">Transactions</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('transactions.transaction_detail', transaction_id=transaction.id) }}">Transaction {{ transaction.id }}</a></li>
                <li class="breadcrumb-item active">Edit</li>
            </ol>
        </nav>
        
        <h1><i class="bi bi-pencil-square"></i> Edit Transaction</h1>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-info-circle"></i> Transaction Details</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="description" class="form-label">Description *</label>
                                <textarea class="form-control" id="description" name="description" rows="3" required>{{ transaction.description }}</textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="amount" class="form-label">Amount *</label>
                                <div class="input-group">
                                    <input type="number" step="0.01" class="form-control" id="amount" name="amount" value="{{ transaction.amount }}" required>
                                    <input type="text" class="form-control" id="currency" name="currency" value="{{ transaction.currency }}" placeholder="USD" maxlength="3" style="max-width: 80px;" required>
                                </div>
                                <small class="form-text text-muted">Use negative values for expenses, positive for income</small>
                            </div>
                            
                            <div class="mb-3">
                                <label for="date" class="form-label">Date</label>
                                <input type="date" class="form-control" id="date" value="{{ transaction.date }}" readonly>
                                <small class="form-text text-muted">Transaction date cannot be modified</small>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="payee_name" class="form-label">Payee Name</label>
                                <input type="text" class="form-control" id="payee_name" name="payee_name" value="{{ transaction.payee_name or '' }}">
                            </div>
                            
                            <div class="mb-3">
                                <label for="merchant" class="form-label">Merchant</label>
                                <input type="text" class="form-control" id="merchant" name="merchant" value="{{ transaction.merchant or '' }}">
                            </div>
                            
                            <div class="mb-3">
                                <label for="payment_reference" class="form-label">Payment Reference</label>
                                <input type="text" class="form-control" id="payment_reference" name="payment_reference" value="{{ transaction.payment_reference or '' }}">
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-check-circle"></i> Update Transaction
                        </button>
                        <a href="{{ url_for('transactions.transaction_detail', transaction_id=transaction.id) }}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-info-circle"></i> Current Status</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <span class="badge bg-{{ 'success' if transaction.is_coded else 'secondary' }} fs-6">
                        {{ transaction.status_display }}
                    </span>
                </div>
                
                <div class="mb-3">
                    <strong>Documents:</strong> {{ transaction.documents|length }} file{{ 's' if transaction.documents|length != 1 else '' }}
                </div>
                
                {% if transaction.transaction_code %}
                    <div class="mb-3">
                        <strong>Category:</strong> {{ transaction.transaction_code.category_name }}<br>
                        {% if transaction.transaction_code.notes %}
                            <strong>Notes:</strong> {{ transaction.transaction_code.notes[:100] }}{% if transaction.transaction_code.notes|length > 100 %}...{% endif %}
                        {% endif %}
                    </div>
                {% endif %}
                
                <small class="text-muted">
                    Created: {{ transaction.created_at.strftime('%Y-%m-%d %H:%M') if transaction.created_at else 'Unknown' }}
                </small>
            </div>
        </div>
        
        <!-- Warning Box -->
        <div class="card border-warning mt-3">
            <div class="card-header bg-warning text-dark">
                <h6 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Important Notes</h6>
            </div>
            <div class="card-body">
                <small>
                    <ul class="mb-0">
                        <li>Transaction date cannot be modified</li>
                        <li>Changes will not affect linked documents or coding</li>
                        <li>Amount changes may affect reports</li>
                        <li>Currency must be 3-letter code (e.g., USD, EUR)</li>
                    </ul>
                </small>
            </div>
        </div>
    </div>
</div>
{% endblock %}